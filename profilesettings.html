<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Baba Telehealth Dashboard</title>
    <link rel="stylesheet" href="/public/css/dashboard.css" />
    <script
      src="https://kit.fontawesome.com/38b421c4ae.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="sidebar">
      <ul class="nav" id="sidemenu">
        <div class="logo">
          <a href="/"><img src="/public/icons/nav-logo.png" alt="logo" /></a>
        </div>
        <li><a href="/dashboard">Dashboard</a></li>
        <li><a href="#">Consultation</a></li>
        <li><a href="#">Appointments</a></li>
        <li><a href="#">Messaging</a></li>
        <li><a href="#">Payment History</a></li>
        <i class="fas fa-times" onclick="closeMenu()"></i>
      </ul>
      <i class="fas fa-bars" style="margin-top: 18px" onclick="openMenu()"></i>
    </div>
    <div class="main-content">
      <header class="header">
        <h3 class="title">Profile Settings</h3>
        <!-- Buttons will appear in header on large screens -->
        <button class="button urgent-care">Urgent Care</button>
        <button class="button book-now">Book Now</button>
        <div class="icons">
          <span class="notification-icon"
            ><img src="/public/icons/noti.png" alt=""
          /></span>
          <div class="profile-container">
            <div class="patient-icon" onclick="toggleDropdown()">
              <img src="/public/icons/userIcon.png" id="" alt="Patient-image" />
            </div>
            <div class="dropdown-menu" id="dropdownMenu">
              <a href="/" class="dropdown-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                </svg>
                Home
              </a>
              <a href="/dashboard/setting" class="dropdown-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                  />
                </svg>
                Profile Settings
              </a>
              <span class="dropdown-item" id="logout-button">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path d="M10 17l5-5-5-5v10z" />
                </svg>
                Logout
              </span>
            </div>
          </div>
        </div>
      </header>
      <!-- Buttons will appear outside the header on small screens -->
      <div class="button-container">
        <button class="button urgent-care">Urgent Care</button>
        <button class="button book-now">Book Now</button>
      </div>

      <div class="profile-settings-container">
        <div class="profile-picture">
          <img
            id="profile-image"
            src="/public/icons/profileIcon.png"
            alt="Profile Picture"
          />
        </div>
        <form
          action="/auth/api/profile"
          method="POST"
          enctype="multipart/form-data"
        >
          <input
            type="file"
            id="image-upload"
            name="profilePicture"
            accept="image/*"
            onchange="loadImage(event)"
          />

          <div id="loading-indicator" style="display: none; text-align: center">
            <div class="spinner"></div>
            <p>Loading, please wait...</p>
          </div>

          <label for="name">Name</label>
          <input type="text" id="patient-name" name="name" required="" />

          <label for="phone"
            >Phone number where the doctor can contact you</label
          >
          <input
            type="text"
            id="phone"
            name="phone"
            placeholder="Add Phone Number"
            required
          />

          <label for="about">About yourself</label>
          <textarea
            id="about"
            name="about"
            rows="4"
            cols="50"
            placeholder="Write something about yourself"
          ></textarea>
          <input
            type="submit"
            value="Update Personal Info"
            class="submit-btn"
          />
        </form>
      </div>
    </div>
    <script>
      // Patient Profile update setting
      const form = document.querySelector("form[action='/auth/api/profile']");

      form.addEventListener("submit", async function (event) {
        event.preventDefault(); // Prevent default form submission behavior

        const formData = new FormData(form);

        try {
          const response = await fetch(form.action, {
            method: form.method,
            body: formData,
            credentials: "include", // Include cookies for authentication
          });

          if (response.ok) {
            const data = await response.json();
            alert(data.message); // Show success message
            window.location.reload(); // Reload the page
          } else {
            const errorData = await response.json();
            alert(errorData.message || "Failed to update profile");
          }
        } catch (error) {
          console.error("Error updating profile:", error);
          alert("An unexpected error occurred. Please try again.");
        }
      });
    </script>
    <script src="/public/dashboardScript.js"></script>
  </body>
</html>
